<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PharmacyController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">mask</a> &gt; <a href="index.source.html" class="el_package">ntou.cs.hw4.mask.controller</a> &gt; <span class="el_source">PharmacyController.java</span></div><h1>PharmacyController.java</h1><pre class="source lang-java linenums">package ntou.cs.hw4.mask.controller;


import java.net.URI;
import java.util.ArrayList;
import java.util.List;

import javax.validation.Valid;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.support.ServletUriComponentsBuilder;

import ntou.cs.hw4.mask.entity.Pharmacy;
import ntou.cs.hw4.mask.entity.PharmacyRequest;
import ntou.cs.hw4.mask.service.PharmacyService;


@Controller
<span class="fc" id="L29">public class PharmacyController {</span>
	
	@Autowired
	PharmacyService pharmacyService;
	
	@GetMapping(&quot;/test&quot;)
	public String test(){
<span class="fc" id="L36">		return &quot;test&quot;;</span>
	}

	@GetMapping(&quot;/pharmacy&quot;)
	public String getAllPharmacy(@RequestParam(required = false) String pharmacyName,@RequestParam(required = false) String zone, Model model){
		
		List&lt;Pharmacy&gt; pharmacy;
<span class="nc bnc" id="L43" title="All 2 branches missed.">		if (pharmacyName == null) pharmacyName = &quot;&quot;;</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">		if (zone == null) zone = &quot;&quot;;</span>
<span class="nc" id="L45">		pharmacyName = pharmacyName.strip();</span>
<span class="nc" id="L46">		zone = zone.strip();</span>
<span class="nc" id="L47">		pharmacy = pharmacyService.getPharmacies(pharmacyName,zone);</span>
<span class="nc" id="L48">		model.addAttribute(&quot;pharmacy&quot;,pharmacy);</span>
<span class="nc" id="L49">		return &quot;pharmacy&quot;;</span>
	}
	
	@GetMapping(&quot;/pharmacy/{id}&quot;)
	public ResponseEntity&lt;Pharmacy&gt; getPharmacy(@PathVariable(&quot;id&quot;) String id){
<span class="nc" id="L54">		Pharmacy match = pharmacyService.getPharmacy(id);</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">		if (match != null)</span>
<span class="nc" id="L56">			return ResponseEntity.ok().body(match);</span>
		else
<span class="nc" id="L58">			return ResponseEntity.notFound().build();	</span>
	}
	
	@PostMapping(&quot;/pharmacy/{id}/note&quot;)
	public ResponseEntity&lt;String&gt; addNote(@Valid @RequestBody PharmacyRequest request){
<span class="nc" id="L63">		Pharmacy pharmacy = pharmacyService.createNote(request);</span>
		URI location = ServletUriComponentsBuilder
<span class="nc" id="L65">                .fromCurrentRequest()</span>
<span class="nc" id="L66">                .path(&quot;/pharmacy/{id}&quot;)</span>
<span class="nc" id="L67">                .buildAndExpand(pharmacy.getId())</span>
<span class="nc" id="L68">                .toUri();</span>
<span class="nc" id="L69">		return ResponseEntity.created(location).body(request.getNote());</span>
	}
	
	@PutMapping(&quot;/pharmacy/{id}/note&quot;)
	public ResponseEntity&lt;String&gt; modifyNote(@Valid @RequestBody PharmacyRequest request){
<span class="nc" id="L74">		Boolean changed = pharmacyService.modifyNote(request);</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">		if(changed)</span>
<span class="nc" id="L76">			return ResponseEntity.ok().body(&quot;Success&quot;);</span>
		else
<span class="nc" id="L78">			return ResponseEntity.badRequest().body(&quot;Error&quot;);</span>
	}
	
	@DeleteMapping(&quot;/pharmacy/{id}/note&quot;)
	public ResponseEntity&lt;String&gt; deleteNote(@PathVariable(&quot;id&quot;) String id){
<span class="nc" id="L83">		pharmacyService.deleteNote(id);</span>
<span class="nc" id="L84">		return ResponseEntity.ok().build();</span>
		
	}
	
//	private List&lt;Product&gt; productDB = new ArrayList&lt;&gt;();
//	
//	@GetMapping(&quot;/&quot;)
//	public ResponseEntity&lt;List&lt;Product&gt;&gt; getAllProducts(Model model){
//		return ResponseEntity.ok().body(productDB);
//	}
//	
//	@PostMapping(&quot;/products&quot;)
//	public ResponseEntity&lt;String&gt; createProduct(@RequestBody Product request){
//		Product product = new Product();
//		product.setId(request.getId());
//		product.setName(request.getName());
//		product.setPrice(request.getPrice());
//		productDB.add(product);
//		return ResponseEntity.ok().body(&quot;{}&quot;);
//	}
//	
//	@GetMapping(&quot;/products/{id}&quot;)
//	public ResponseEntity&lt;Product&gt; getProduct(@PathVariable(&quot;id&quot;) String id){
//		Product matchedProduct = null;
//		
//		for ( Product p: productDB) {
//			if (p.getId().equals(id)) {
//				matchedProduct = p;
//			}
//		}
//		
//		if (matchedProduct != null)
//			return ResponseEntity.ok().body(matchedProduct);
//		else
//			return ResponseEntity.notFound().build();
//	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>